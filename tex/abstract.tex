% !TEX root = ../thesis.tex

\begin{abstract}
  直播与分享已经成为人们生活中的一部分。然而，当海量的媒体数据在网络上传输的时候，会受到网络带宽波动的影响，高带宽占用也会引发网络拥塞等问题；另一方面，在实时应用中，低延迟深刻影响了用户体验。在如今的直播行业中有着二八定律：20\%的热门视频流（简称头部流）占据了80\%的流量，对于占有头部流量的大主播，观众人数多，亟需更高编码效率的新视频编码标准应用以减少CDN（Content Delivery Network）流量的费用支出，然而，由于新一代视频编码标准的复杂度往往数倍于上一代编码标准，在编码效率得到提升的同时，也导致了更高的编码延时的问题，在实时应用中亟待解决。本课题旨在研究新的编码标准在直播系统中的低延时优化，以解决以上痛点。

  本文首先对视频编码标准进行调研，对比各视频编码标准后选择AV1作为视频编码标准，对流媒体传输协议、封装协议进行调研，综合考虑延迟性能与扩展性选择协议，以FFmpeg与SVT-AV1等开源软件搭建了AV1低延迟直播系统原型，并在此基础上对该原型直播系统进行了延迟的分析与优化。优化主要在两个维度进行，一方面从系统层面优化系统中不必要的延迟、降低由于传输协议导致的延迟等；另一方面深入SVT-AV1编码器内部，分析编码过程中编码器内部的延迟来源并加以优化。

  系统层面的优化包括对SVT-AV1的高启动延迟优化与FFmpeg中AV1的RTP封装实现，完成后，系统端到端延迟降低至2秒左右，此时延迟主要来源为SVT-AV1编码器的编码延迟，因此需要对SVT-AV1编码器内部进行优化。

  降低编码延迟的方法为提升并行效率与降低计算量。在SVT架构已经尽可能提升了并行效率的前提下，本文优化方向主要是降低编码计算量。据此提出了基于人眼视觉感知特性的超级块快速划分算法，首先从基于亮度适应性、对比度掩蔽效应等视觉特性的JND感知阈值模型简化得到块级JND感知阈值模型，并根据该块级JND模型计算与块划分相关的感知划分指标。以Twitch的游戏测试序列为优化对象，分析了游戏测试序列的感知划分指标统计特征，取合适的感知划分指标阈值，在编码过程中实现提前终止划分。实验表明，对1080P视频序列的一帧计算该块级JND模型的时间小于1.8ms，以损失2\%编码效率的代价，在SVT-AV1编码器最快预设基础，所提算法在All Intra和Low Delay P两种GOP结构上均可以减少15\%左右的编码时间。
  % TODO 加入最终系统的延迟结果

  % 中文摘要应该将学位论文的内容要点简短明了地表达出来，应该包含论文中的基本信息，
  % 体现科研工作的核心思想。摘要内容应涉及本项科研工作的目的和意义、研究方法、研究
  % 成果、结论及意义。注意突出学位论文中具有创新性的成果和新见解的部分。摘要中不宜
  % 使用公式、化学结构式、图表和非公知公用的符号和术语，不标注引用文献编号。硕士学
  % 位论文中文摘要字数为 500 字左右，博士学位论文中文摘要字数为 800 字左右。英文摘
  % 要内容应与中文摘要内容一致。

  % 摘要页的下方注明本文的关键词（4～6个）。
\end{abstract}

\begin{enabstract}
  Live broadcasting and sharing have become an important part of people's daily lives. However, when massive media data is transmitted on the network, it will be affected by network bandwidth fluctuations, and high bandwidth usage will also cause problems such as network congestion; on the other hand, in real-time applications, low latency profoundly affects the user experience. In today's live broadcast industry, there is a 80/20 rule in distribution of video workloads that 20 \% of the most popular video streams make up 80\% of traffic. For these head channels, we urgently need some more efficient video coding standards to reduce the CDN (Content Delivery Network) cost. However, because the complexity of new generation video coding standards is often hundred times that of previous ones, while the coding efficiency is improved, it also causes higher coding latency. It needs to be solved in real-time applications. In this paper, will study the low-latency optimization of the new coding standard in the live broadcast system to solve the above pain points.

  In the paper, first investigates video coding standards, after compares each video coding standard and selects AV1 to use in our system, then investigates streaming protocols and containers, comprehensively considers latency and scalability to select protocols. Based on FFmpeg and SVT-AV1, AV1 low-latency live broadcast system prototype is built. Then the paper do analysis and optimization on the prototype. The optimization is carried out in two dimensions. Firstly, optimize the unnecessary delay from the system level, reduce the latency caused by the streaming protocol. Secondly, dive deeply into the SVT-AV1 codec and optimize the latency inside the codec.

  System-level optimization includes optimization of high initialization delay of SVT-AV1 and RTP packaging of AV1 in FFmpeg. After completing these optimizations, the system's end-to-end delay is reduced to about 2 seconds. At this time, the main source of latency is the codec latency inside SVT-AV1 and it needs to be optimized internally.

  The method to reduce the codec latency is to increase the parallel efficiency and reduce the amount of calculation. Under the premise that the SVT architecture has improved parallel efficiency as much as possible, our optimization direction is to reduce the amount of coding calculation. This paper proposes a fast partition algorithm based on human visual perception characteristics. First, the block-level JND perception threshold model is simplified from the JND perception threshold model based on visual characteristics such as luminance adaptability and contrast masking effect. The paper then proposes a perceptual partitioning indicators (PI) related to partitioning. Taking the game test sequence of Twitch as the optimization object, the statistical characteristics of PI of the game test sequence are analyzed, and the appropriate perceptual threshold (PT) of the PI is selected. Partition can be  terminated early in the coding process when the block PI is lower then PI. Experiments show that the time to calculate the block-level JND model for a frame of 1080P video is less than 1.8ms, at the cost of 2\% of coding efficiency, the proposed algorithm can reduce 15\% encoding time on the basis of SVT-AV1's fastest preset. Test is on the both GOP structure of All Intra and Low Delay P.
\end{enabstract}
